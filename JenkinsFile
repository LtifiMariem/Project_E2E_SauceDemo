pipeline {
    agent any 

    
    triggers {
       cron('* * * * *') 
   }

    environment {
        
JAVA_HOME = 'C:/Program Files/Java/jdk-17'


MAVEN_HOME = 'C:/Users/Administrator/apache-maven-3.9.11'



PATH = "${JAVA_HOME}/bin;${MAVEN_HOME}/bin;${env.PATH}"

    }

    stages {
        
        stage('Checkout') {
            steps {
                git branch: 'master', 
                    url: 'https://github.com/LtifiMariem/Project_E2E_SauceDemo.git', 
                    credentialsId: 'jeton GitHub' // ID du credential créé dans Jenkins
            }
        }

        stage('Build') {
            steps {
                echo 'Building the project...'
                bat 'mvn clean compile' 
            }
        }

        // Étape 3 : Lancer les tests automatisés
        stage('Run Tests') {
            steps {
                echo 'Running tests...'
                bat 'mvn test'
            }
        }

        // Étape 4 : Publier les rapports (exemple pour Cucumber)
        stage('Publish Reports') {
            steps {
                echo 'Publishing Cucumber report...'
                // Si tu utilises le plugin cucumber-reporting
                cucumber buildStatus: 'UNSTABLE', fileIncludePattern: 'target/report/cucumber.json'
            }
        }
    }

    post {
        always {
            echo 'Cleaning workspace...' // Toujours nettoyer après exécution
        }
        success {
            echo 'Tests passed!' // Message si tout réussit
        }
        failure {
            echo 'Tests failed!' // Message si échec
        }
    }
}